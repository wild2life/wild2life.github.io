import{_ as e,h as a,o as s,aa as i}from"./chunks/framework.CMyQ9WBu.js";const b=JSON.parse('{"title":"飞书二维码本地开发加载失败问题排查指南","description":"","frontmatter":{},"headers":[],"relativePath":"daily-notes/issue-18.md","filePath":"daily-notes/issue-18.md","lastUpdated":null}'),t={name:"daily-notes/issue-18.md"},o=i('<h1 id="飞书二维码本地开发加载失败问题排查指南" tabindex="-1">飞书二维码本地开发加载失败问题排查指南 <a class="header-anchor" href="#飞书二维码本地开发加载失败问题排查指南" aria-label="Permalink to &quot;飞书二维码本地开发加载失败问题排查指南&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">原文地址</p><p><a href="https://github.com/wild2life/daily-notes/issues/18" target="_blank" rel="noreferrer">飞书二维码本地开发加载失败问题排查指南 | GitHub</a></p></div><h2 id="📌-问题背景" tabindex="-1">📌 问题背景 <a class="header-anchor" href="#📌-问题背景" aria-label="Permalink to &quot;📌 问题背景&quot;">​</a></h2><p>在本地开发过程中，访问 <code>http://192.168.x.x:port/auth/qrcode-login</code> 时，飞书二维码组件无法正常加载，而 <code>http://localhost:port/auth/qrcode-login</code> 下二维码加载正常。</p><p>控制台报出如下警告：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>Chrome is moving towards a new experience that allows users to choose to browse without third-party cookies.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="🧠-问题根因" tabindex="-1">🧠 问题根因 <a class="header-anchor" href="#🧠-问题根因" aria-label="Permalink to &quot;🧠 问题根因&quot;">​</a></h2><p>飞书扫码登录依赖于 <strong>第三方 Cookie</strong> 以及 <strong>跨域资源加载</strong>，而现代浏览器（如 Chrome）对第三方 Cookie 存取有严格限制。</p><h3 id="🚫-为什么-192-168-x-x-不行" tabindex="-1">🚫 为什么 <code>192.168.x.x</code> 不行？ <a class="header-anchor" href="#🚫-为什么-192-168-x-x-不行" aria-label="Permalink to &quot;🚫 为什么 `192.168.x.x` 不行？&quot;">​</a></h3><p>Chrome 认为 <code>192.168.x.x</code> 是不安全的上下文（非 <code>secure</code> origin），在该上下文中：</p><ul><li>Cookie 的 <code>SameSite=None</code> 不会生效；</li><li>第三方资源（如飞书二维码 SDK）尝试设置 Cookie 会被浏览器拦截；</li><li>导致二维码 SDK 登录流程被中断或二维码不显示。</li></ul><h3 id="✅-为什么-localhost-可以" tabindex="-1">✅ 为什么 <code>localhost</code> 可以？ <a class="header-anchor" href="#✅-为什么-localhost-可以" aria-label="Permalink to &quot;✅ 为什么 `localhost` 可以？&quot;">​</a></h3><ul><li><code>localhost</code> 被视为浏览器的<strong>安全上下文（Secure Context）</strong>；</li><li>即便是 <code>http://localhost</code>，也可以使用第三方 Cookie；</li><li>飞书二维码加载与扫码登录流程均能正常完成。</li></ul><hr><h2 id="✅-推荐解决方案" tabindex="-1">✅ 推荐解决方案 <a class="header-anchor" href="#✅-推荐解决方案" aria-label="Permalink to &quot;✅ 推荐解决方案&quot;">​</a></h2><h3 id="方案一-使用-localhost-或-127-0-0-1-进行开发调试-✅-推荐" tabindex="-1">方案一：使用 <code>localhost</code> 或 <code>127.0.0.1</code> 进行开发调试 ✅ 推荐 <a class="header-anchor" href="#方案一-使用-localhost-或-127-0-0-1-进行开发调试-✅-推荐" aria-label="Permalink to &quot;方案一：使用 `localhost` 或 `127.0.0.1` 进行开发调试 ✅ 推荐&quot;">​</a></h3><ul><li>请将本地服务绑定在 <code>localhost</code>，而非 <code>192.168.x.x</code>；</li><li>示例访问地址应为：</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>http://localhost:5567/auth/qrcode-login</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>💡 <strong>建议</strong>：如需远程设备访问本地服务，推荐使用 <code>ngrok</code>、<code>localtunnel</code> 或 <code>frp</code> 将服务暴露为公网 HTTPS 域名。</p></blockquote><hr><h3 id="方案二-搭建-https-自签名证书-进阶" tabindex="-1">方案二：搭建 HTTPS + 自签名证书（进阶） <a class="header-anchor" href="#方案二-搭建-https-自签名证书-进阶" aria-label="Permalink to &quot;方案二：搭建 HTTPS + 自签名证书（进阶）&quot;">​</a></h3><p>如必须使用内网 IP 地址（如 <code>192.168.x.x</code>）：</p><ol><li>为本地开发环境配置 HTTPS；</li><li>使用自签名证书，并在浏览器中信任；</li><li>确保请求头中允许 <code>SameSite=None; Secure</code> 的 cookie；</li><li>修改浏览器安全策略接受自签名 HTTPS。</li></ol><blockquote><p>⚠️ 本方案实现复杂，建议只用于企业内测或对接 QA 测试使用。</p></blockquote><hr><h3 id="方案三-临时关闭浏览器-samesite-策略-开发环境调试" tabindex="-1">方案三：临时关闭浏览器 SameSite 策略（开发环境调试） <a class="header-anchor" href="#方案三-临时关闭浏览器-samesite-策略-开发环境调试" aria-label="Permalink to &quot;方案三：临时关闭浏览器 SameSite 策略（开发环境调试）&quot;">​</a></h3><p>可在启动 Chrome 时添加启动参数，<strong>临时</strong>禁用 SameSite Cookie 策略：</p><h4 id="macos-linux" tabindex="-1">macOS/Linux <a class="header-anchor" href="#macos-linux" aria-label="Permalink to &quot;macOS/Linux&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/Applications/Google\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Chrome.app/Contents/MacOS/Google</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Chrome</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--disable-features=SameSiteByDefaultCookies,CookiesWithoutSameSiteMustBeSecure</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="windows" tabindex="-1">Windows <a class="header-anchor" href="#windows" aria-label="Permalink to &quot;Windows&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chrome.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disable-features=SameSiteByDefaultCookies,CookiesWithoutSameSiteMustBeSecure</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>⚠️ 仅用于开发阶段调试，<strong>切勿在生产环境使用</strong>！</p></blockquote><hr><h2 id="🔍-控制台-warning-说明" tabindex="-1">🔍 控制台 Warning 说明 <a class="header-anchor" href="#🔍-控制台-warning-说明" aria-label="Permalink to &quot;🔍 控制台 Warning 说明&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>Chrome is moving towards a new experience that allows users to choose to browse without third-party cookies.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这是 Chrome 在为即将全面禁用第三方 Cookie 做预警。未来建议全面采用：</p><ul><li>自定义 OAuth 网关；</li><li>使用一体化登录页统一跳转；</li><li>避免第三方 Cookie 的依赖。</li></ul><hr><h2 id="✅-总结建议" tabindex="-1">✅ 总结建议 <a class="header-anchor" href="#✅-总结建议" aria-label="Permalink to &quot;✅ 总结建议&quot;">​</a></h2><table><thead><tr><th>场景</th><th>推荐做法</th></tr></thead><tbody><tr><td>本地调试</td><td>使用 <code>localhost</code> 而非 IP</td></tr><tr><td>二维码无法加载</td><td>检查 Cookie 策略与浏览器上下文</td></tr><tr><td>跨设备调试</td><td>使用 ngrok/frp 提供 HTTPS 访问</td></tr><tr><td>企业内测</td><td>可搭建 HTTPS 内网服务 + 信任证书</td></tr></tbody></table><hr><h2 id="📌-附-二维码-sdk-示例引用" tabindex="-1">📌 附：二维码 SDK 示例引用 <a class="header-anchor" href="#📌-附-二维码-sdk-示例引用" aria-label="Permalink to &quot;📌 附：二维码 SDK 示例引用&quot;">​</a></h2><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://lf-package-cn.feishucdn.com/obj/feishu-static/lark/passport/qrcode/LarkSSOSDKWebQRCode-1.0.111.js?v=1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><hr>',44),l=[o];function n(r,h,d,c,p,u){return s(),a("div",null,l)}const m=e(t,[["render",n]]);export{b as __pageData,m as default};
